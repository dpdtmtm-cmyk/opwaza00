<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>ONE PIECE 4ã¤ã®æ¼¢å­—ãƒ¢ãƒ¼ãƒ‰</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
    
<style>
body {
    font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
    background: #0b1220;
    color: #e6eef6;
    padding: 20px;
}
.container {
    max-width: 900px;
    margin: 0 auto;
    background: #0f1724;
    padding: 18px;
    border-radius: 10px;
    box-shadow: 0 4px 18px rgba(0,0,0,0.6);
}
h1 { margin-top: 0; font-size: 22px; }
.kanji-box {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px 56px;          /* ç¸¦ æ¨ªï¼šå°‘ã—åºƒã’ã‚‹ */
    justify-items: center;

    font-size: 56px;        /* è¦–èªæ€§ã‚¢ãƒƒãƒ— */
    line-height: 1.1;

    background: #071021;
    padding: 16px 20px;     /* ä¸Šä¸‹ã‚’è©°ã‚ã¦1ç”»é¢ç¶­æŒ */
    border-radius: 8px;
    margin: 16px 0;         /* ç¸¦ä½™ç™½ã‚‚å°‘ã—å‰Šæ¸› */

    letter-spacing: 0;
}

.kanji-box span {
    display: inline-block;
}
@media (max-width: 600px) {
    .kanji-box {
        /* æ­£æ–¹å½¢ã ãŒãƒ‡ã‚«ã™ããªã„ */
        aspect-ratio: 1 / 1;
        width: 100%;
        max-width: 320px;        /* â† ãƒ‡ã‚«ã•ã®å…ƒå‡¶ã‚’æ­¢ã‚ã‚‹ */
        margin: 12px auto;

        /* ã‚°ãƒªãƒƒãƒ‰ã‚’å·¦å³ã«å¼µã‚‹ */
        grid-template-columns: 1fr 1fr;
        justify-items: stretch; /* â† é‡è¦ */
        align-items: center;

        font-size: 52px;
        line-height: 1;

        gap: 20px 0;             /* æ¨ªgapã‚’æ¶ˆã—ã¦â€œå¼µã‚Šâ€ã‚’å‡ºã™ */
        padding: 14px 18px;
    }

    .kanji-box span {
        display: block;
        text-align: center;
        width: 100%;             /* â† å„ãƒã‚¹ã‚’æœ€å¤§å¹…ã« */
    }
}


button {
    padding: 10px 14px;
    border: none;
    border-radius: 6px;
    background: #2b8bd6;
    color: white;
    cursor: pointer;
    margin-right: 6px;
}
#result {
    background: #071828;
    margin-top: 15px;
    padding: 15px;
    border-radius: 8px;
}
input, select {
    padding: 8px;
    border-radius: 6px;
    border: 1px solid #274b67;
    background: #071826;
    color: #e6eef6;
}
/* ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ */
#menuButton {
    position: fixed;
    top: 14px;
    left: 14px;
    font-size: 26px;
    cursor: pointer;
    z-index: 1001;
    user-select: none;
}

#sideMenu {
    position: fixed;
    top: 0;
    left: 0;
    width: 220px;
    height: 100%;
    background: #071021;
    box-shadow: 4px 0 12px rgba(0,0,0,0.6);
    transform: translateX(-100%);
    transition: transform 0.25s ease;
    z-index: 1000;
}

#sideMenu.open {
    transform: translateX(0);
}

.menuContent {
    padding: 20px;
}

.menuContent h2 {
    margin-top: 0;
    font-size: 18px;
}

.menuContent p {
    margin-top: 12px;
    font-size: 14px;
    color: #cfe4ff;
}
/* ===== ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ ===== */
body.light {
    background: #f5f7fb;
    color: #0b1220;
}

body.light .container {
    background: #ffffff;
    box-shadow: 0 4px 18px rgba(0,0,0,0.15);
}

body.light .kanji-box {
    background: #eef2f8;
}

body.light input,
body.light select {
    background: #ffffff;
    color: #0b1220;
    border-color: #c5d3e3;
}

body.light #result {
    background: #eef2f8;
}

body.light #sideMenu {
    background: #ffffff;
}

body.light .menuContent p {
    color: #334155;
}
    
</style>
</head>
<body>
<!-- ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
<div id="menuButton">â˜°</div>

<div id="sideMenu">
  <div class="menuContent">
    <h2>æƒ…å ±</h2>
    <p>ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼š<strong>Ver 1.0.43</strong></p>
<button id="themeToggle"
  style="
    margin-top:12px;
    width:100%;
    padding:10px 12px;
    border-radius:6px;
    background:#2b8bd6;
    color:white;
    border:none;
    cursor:pointer;
  ">
  ğŸŒ ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰
</button>

     
<hr style="border:0;border-top:1px solid #274b67;margin:16px 0;">

    <a href="https://x.com/sa_sisusesaw?s=21"
       target="_blank"
       rel="noopener noreferrer"
       style="
         display:block;
         padding:10px 12px;
         border-radius:6px;
         background:#0b1c33;
         color:#cfe4ff;
         text-decoration:none;
         font-size:14px;
       ">
      ğŸ ãƒã‚°å ±å‘Šãƒ»ãŠå•ã„åˆã‚ã›
    </a>
  </div>
</div>

<div class="container">
<h1>ONE PIECE â€” 4ã¤ã®æ¼¢å­—ãƒ¢ãƒ¼ãƒ‰</h1>

<button onclick="newQuestion()">æ–°ã—ã„å•é¡Œ</button>
<button onclick="showAnswer()">æ­£è§£ã‚’è¦‹ã‚‹</button>

<div class="kanji-box" id="kanjiBox">â€” â€” â€” â€”</div>
<div id="warning" style="display:none; margin-top:6px; color:#ffd36a; font-size:14px;">
âš  åŒä¸€æ¼¢å­—ã‚­ãƒ£ãƒ©ã‚ã‚Š
</div>

<input id="answerInput" placeholder="ã‚­ãƒ£ãƒ©åã‚’å…¥åŠ›ã—ã¦Enterã§å›ç­”">
<select id="candidateSelect" size="6" style="width:100%; max-width:600px; margin-top:10px;"></select>

<div id="result"></div>
</div>

<script>
// =====================
// waza01.txt ã‚’èª­ã¿è¾¼ã¿ â†’ DATA / ALIAS ã‚’ç”Ÿæˆ
// =====================

let DATA = {};
let ALIAS = {};

async function loadData() {
    const text = await fetch("waza01.txt").then(r => r.text());
    parseText(text);
    populateCandidates();
    newQuestion();
}

// =====================
// ãƒ†ã‚­ã‚¹ãƒˆè§£æå‡¦ç†
// =====================
function parseText(raw) {
    DATA = {};
    ALIAS = {};

    const lines = raw.split(/\r?\n/);
    let current = null;

    for (let line of lines) {
        line = line.trim();
        if (!line) continue;

        // ã€Šæ ã€‹ â†’ ã‚­ãƒ£ãƒ©ãƒªã‚»ãƒƒãƒˆï¼ˆç„¡è¦–ï¼‰
        if (line.startsWith("ã€Š") && line.includes("ã€‹")) {
            current = null;
            continue;
        }

        // ã€ã‚­ãƒ£ãƒ©åã€‘
        const m = line.match(/^ã€([^ã€‘]+)ã€‘/);
        if (m) {
            let nameBlock = m[1];

            // (: ) å†…ã®åˆ¥å
            let alt = null;
            const altM = nameBlock.match(/(.+)\s*\(:\s*([^()]+)\s*\)$/);
            let main;

            if (altM) {
                main = altM[1].trim();
                alt = altM[2].trim();
                ALIAS[main] = [alt];
            } else {
                main = nameBlock.trim();
                ALIAS[main] = [];
            }

            // æœ€å¾Œã®ã€Œãƒ»ã€ä»¥é™ã‚‚åˆ¥å
            if (main.includes("ãƒ»")) {
                ALIAS[main].push(main.split("ãƒ»").pop());
            }

            // ã‚­ãƒ£ãƒ©ç™»éŒ²
            if (!DATA[main]) DATA[main] = [];

            current = main;

            // èª¤ã£ã¦ç¶šãã‚’æŠ€ã¨ã—ã¦è§£æã—ãªã„
            line = line.slice(m[0].length).trim();
            if (!line) continue;
        }

        if (!current) continue;

        // â— ã®æŠ€ã ã‘ä½¿ã†ï¼ˆâ—‹ã¯ç„¡è¦–ï¼‰
        const techM = line.match(/^â—\s*(.+)/);
        if (!techM) continue;

        let tech = techM[1];
        tech = tech.replace(/\(.*?\)/g, ""); // () ã¯å‰Šé™¤
        tech = tech.trim();

        if (tech) {
            const kanji = tech.match(/[ä¸€-é¾¥]/g) || [];
            DATA[current].push({ name: tech, kanji });
        }
    }

    // æ¼¢å­—ã‚’1ã¤ã‚‚æŒãŸãªã„ã‚­ãƒ£ãƒ©ã¯é™¤å¤–
    for (const ch of Object.keys(DATA)) {
        if (!DATA[ch].some(t => t.kanji.length > 0)) {
            delete DATA[ch];
            delete ALIAS[ch];
        }
    }
}

// =====================
// UI ç³»å‡¦ç†
// =====================
function sample(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]];} return arr; }
function findSameKanjiChars(targetKanji, mainChar) {
    const result = [];
    const targetSet = new Set(targetKanji);

    for (const ch of Object.keys(DATA)) {
        if (ch === mainChar) continue;

        const kanjiSet = new Set();
        DATA[ch].forEach(t => {
            t.kanji.forEach(k => kanjiSet.add(k));
        });

        let ok = true;
        for (const k of targetSet) {
            if (!kanjiSet.has(k)) {
                ok = false;
                break;
            }
        }

        if (ok) result.push(ch);
    }
    return result;
}

let current = null;
let extraAnswers = [];

function populateCandidates() {
    const sel = document.getElementById("candidateSelect");
    sel.innerHTML = "";

    // ç„¡é¸æŠçŠ¶æ…‹
    const none = document.createElement("option");
    none.value = "";
    none.textContent = "---ï¼ˆç„¡é¸æŠï¼‰---";
    sel.appendChild(none);

    Object.keys(DATA).sort().forEach(ch=>{
        const op = document.createElement("option");
        op.value = ch;
        op.textContent = ch;
        sel.appendChild(op);
    });

    sel.value = ""; // åˆæœŸçŠ¶æ…‹ã‚’ç„¡é¸æŠã«
}

// -----------------------
// å•é¡Œç”Ÿæˆ
// -----------------------
function newQuestion(){
    const chars = Object.keys(DATA);

    for (let tries=0; tries<300; tries++){
        const ch = sample(chars);
        const techs = DATA[ch].filter(t => t.kanji.length > 0);
        if (techs.length < 4) continue;

        shuffle(techs);
        const chosen = techs.slice(0,4);
        const kanji = chosen.map(t => sample(t.kanji));

        // é‡è¤‡ç¦æ­¢
        if (new Set(kanji).size < 4) continue;

        const shuffledKanji = shuffle([...kanji]);

current = { ch, chosen, kanji: shuffledKanji };

// â˜… åŒä¸€4æ¼¢å­—ã‚­ãƒ£ãƒ©æ¢ç´¢
extraAnswers = findSameKanjiChars(shuffledKanji, ch);
// âš  è¡¨ç¤ºåˆ¶å¾¡
const warn = document.getElementById("warning");
if (extraAnswers.length > 0) {
    warn.style.display = "block";
} else {
    warn.style.display = "none";
}

       const box = document.getElementById("kanjiBox");
box.innerHTML = "";
current.kanji.forEach(k => {
    const s = document.createElement("span");
    s.textContent = k;
    box.appendChild(s);
});

        document.getElementById("result").textContent = "";
        return;
    }

    document.getElementById("kanjiBox").textContent = "ç”Ÿæˆå¤±æ•—";
}

// -----------------------
// å›ç­”ãƒã‚§ãƒƒã‚¯
// -----------------------
function checkAnswer(ans){
    if (!current) return;

    const corr = current.ch;
    const als = ALIAS[corr] || [];

    let ok = false;
    if (ans === corr) ok = true;
    if (als.includes(ans)) ok = true;
    if (extraAnswers.includes(ans)) ok = true; // â˜… è¿½åŠ 

    const r = document.getElementById("result");
    if (ok){
      r.innerHTML = "<strong style='color:#b7f5c7'>æ­£è§£ï¼</strong><br>ã‚­ãƒ£ãƒ©ï¼š" + corr;

if (extraAnswers.length > 0) {
    r.innerHTML += "<br><span style='color:#cfe4ff'>åŒä¸€æ¼¢å­—ã‚­ãƒ£ãƒ©ï¼š</span>"
        + extraAnswers.join("ã€");
}

    } else {
        r.innerHTML = "<strong style='color:#ffbdbd'>ä¸æ­£è§£</strong><br>ã‚ãªãŸï¼š" 
                       + ans + "<br>æ­£è§£ï¼š" + corr;
    }

    r.innerHTML += "<br><br><strong>ä½¿ç”¨æŠ€ï¼š</strong><ul>" +
        current.chosen.map(t => "<li>" + t.name + "ï¼ˆ" + t.kanji.join("") + "ï¼‰</li>").join("")
        + "</ul>";
// â˜… è¿½åŠ ï¼šä¸‹éƒ¨ã«ã‚‚æ–°ã—ã„å•é¡Œãƒœã‚¿ãƒ³
r.innerHTML += `
<br>
<button onclick="newQuestion()" style="
  margin-top:10px;
  padding:10px 14px;
  border:none;
  border-radius:6px;
  background:#2b8bd6;
  color:white;
  cursor:pointer;
">
  æ–°ã—ã„å•é¡Œ
</button>
`;

    // âœ… å›ç­”å¾Œã«å…¥åŠ›ã‚’ãƒªã‚»ãƒƒãƒˆï¼ˆé–¢æ•°å†…ã«å…¥ã‚Œã‚‹ï¼‰
    document.getElementById("answerInput").value = "";
    document.getElementById("candidateSelect").value = "";
}

function showAnswer(){
    if (!current) return;
    checkAnswer("ï¼ˆç„¡å›ç­”ï¼‰");
}

document.getElementById("answerInput").addEventListener("keydown", e=>{
    if(e.key === "Enter"){
        checkAnswer(e.target.value.trim());
    }
});
document.getElementById("candidateSelect").addEventListener("change", e=>{
    if (e.target.value === "") return; // ç„¡é¸æŠã¯ç„¡è¦–
    checkAnswer(e.target.value);
});


// æœ€åˆã®èª­ã¿è¾¼ã¿
// ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼åˆ¶å¾¡
const menuBtn = document.getElementById("menuButton");
const sideMenu = document.getElementById("sideMenu");

menuBtn.addEventListener("click", () => {
    sideMenu.classList.toggle("open");
});
// =====================
// ãƒ†ãƒ¼ãƒåˆ‡æ›¿ï¼ˆä¿å­˜ã‚ã‚Šï¼‰
// =====================
const themeBtn = document.getElementById("themeToggle");

const savedTheme = localStorage.getItem("theme");
if (savedTheme === "light") {
    document.body.classList.add("light");
    themeBtn.textContent = "ğŸŒ™ ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰";
} else {
    themeBtn.textContent = "ğŸŒ ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰";
}

themeBtn.addEventListener("click", () => {
    const isLight = document.body.classList.toggle("light");

    localStorage.setItem("theme", isLight ? "light" : "dark");
    themeBtn.textContent = isLight ? "ğŸŒ™ ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰" : "ğŸŒ ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰";
});


loadData();
</script>

</body>
</html>















